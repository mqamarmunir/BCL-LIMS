/* Copyright: Maxim Saplin 2010, 2011
* Under LGPL License
* Hitch function from http://think-robot.com/2009/06/hitch-object-oriented-event-handlers-with-jquery/ 
*/
(function (a) { a.fn.hitch = function (d, c, b) { return this.bind(d, function () { return c.apply(b || this, Array.prototype.slice.call(arguments)); }); }; })(jQuery); function DropDownScript(g, e, f, c, b, a, d) { this.id = g; this.divPstfx = e; this.selectPstfx = f; this.postbackFunction = c; this.useButtons = b; this.autoPost = a; this.useSelectAll = d; this.divId = this.id + this.divPstfx; this.selId = this.id + this.selectPstfx; this.selection = new Array(); this.visible = false; this.preventHide = false; this.initialized = false; } DropDownScript.prototype.update = function (e, f, c, b, a, d) { this.divPstfx = e; this.selectPstfx = f; this.postbackFunction = c; this.useButtons = b; this.autoPost = a; this.useSelectAll = d; this.divId = this.id + this.divPstfx; this.selId = this.id + this.selectPstfx; this.initEvents(); }; DropDownScript.prototype.init = function () { var a = this; if (typeof Sys != "undefined") { Sys.WebForms.PageRequestManager.getInstance().add_endRequest(function (c, b) { a.initEvents(); }); } this.initEventHandlers(); this.initEvents(); this.initialized = true; }; DropDownScript.prototype.initEventHandlers = function () { this.documentClickHandler = function () { if (!this.preventHide && this.visible) { if (this.useButtons) { this.clickCancel(); } else { if (this.autoPost) { this.clickOk(); } else { this.hide(); } } } this.preventHide = false; }; this.divClickHandler = function (a) { a.stopPropagation(); }; this.selectBoxClickHandler = function (a) { if (this.visible) { this.hide(); } else { this.show(); this.preventHide = true; } }; this.selectAllClickHandler = function (a) { if (!this.useSelectAll) { return; } if (a.target.checked) { this.selectAll(); } else { this.deselectAll(); } }; this.checkBoxClickHandler = function (a) { this.updateSelectAll(); }; this.okClickHandler = function (a) { this.clickOk(); a.stopPropagation(); }; this.cancelHandler = function (a) { this.clickCancel(); a.stopPropagation(); }; }; DropDownScript.prototype.initEvents = function () { if (!this.initialized) { $(document).hitch("click", this.documentClickHandler, this); } var f = $("#" + this.divId); f.unbind("click.chk_dd"); f.hitch("click.chk_dd", this.divClickHandler, this); var c = $("#" + this.selId); c.unbind("click.chk_dd"); c.hitch("click.chk_dd", this.selectBoxClickHandler, this); var b = $("#" + this.divId + " input[type='checkbox']:first"); b.unbind("click.chk_dd"); if (this.useSelectAll) { b.hitch("click.chk_dd", this.selectAllClickHandler, this); } var a = this.getItems(); a.unbind("click.chk_dd"); a.hitch("click.chk_dd", this.checkBoxClickHandler, this); var e = $("#" + this.divId + " input[type='button']:first"); e.unbind("click.chk_dd"); e.hitch("click.chk_dd", this.okClickHandler, this); var d = $("#" + this.divId + " input[type='button']:gt(0)"); d.unbind("click.chk_dd"); d.hitch("click.chk_dd", this.cancelHandler, this); }; DropDownScript.prototype.clickOk = function () { this.hide(); this.saveSelection(); this.doPostBack(); }; DropDownScript.prototype.clickCancel = function () { this.hide(); this.restoreSelection(); }; DropDownScript.prototype.getItems = function () { return $("#" + this.id + " input[type='checkbox']"); }; DropDownScript.prototype.show = function () { $("#" + this.divId).show(); this.visible = true; this.saveSelection(); this.updateSelectAll(); }; DropDownScript.prototype.hide = function () { $("#" + this.divId).hide(); this.visible = false; }; DropDownScript.prototype.updateSelectAll = function () { if (!this.useSelectAll) { return; } var b = true; var a = this.getItems(); for (var c = 0; c < a.length; c++) { if (a[c].checked == false) { b = false; break; } } $("#" + this.divId + " input[type='checkbox']:first").attr("checked", b); }; DropDownScript.prototype.selectAll = function () { this.getItems().attr("checked", true); }; DropDownScript.prototype.deselectAll = function () { this.getItems().attr("checked", false); }; DropDownScript.prototype.saveSelection = function () { var a = this.getItems(); for (var b = 0; b < a.length; b++) { this.selection[b] = a[b].checked ? true : false; } }; DropDownScript.prototype.restoreSelection = function () { var a = this.getItems(); if (this.selection.length > 0) { for (var b = 0; b < a.length; b++) { a[b].checked = this.selection[b]; } } }; DropDownScript.prototype.doPostBack = function () { if (this.postbackFunction) { this.postbackFunction.call(); } };